<%- include('header', {here: 'me'}) %>

<h3>My jukeboxes</h3>
<table>
  <tr>
    <th>ID</th>
    <th>Name</th>
    <th>Description</th>
    <th>Options</th>
  </tr>
  <% if(jukeboxesdata) { 
    jukeboxesdata.forEach(jukebox => { %>
  <tr>
    <td><%= jukebox.jukebox_id %></td>

    <form method="POST" action="/editjukebox" onsubmit="return confirm('Sure you want to update this jukebox?')">
    <input type="hidden" name="jukebox_id" value="<%= jukebox.jukebox_id %>">

    <td id="JtdVN<%= jukebox.jukebox_id %>" style="display: table-cell">
      <a href="/jukebox?id=<%= jukebox.jukebox_id %>"><%= jukebox.jukeboxname %></a>
    </td>
    <td id="JtdVC<%= jukebox.jukebox_id %>" style="display: table-cell"><%= jukebox.jukeboxdesc %></td>
    <td id="JtdVB<%= jukebox.jukebox_id %>" style="display: table-cell; text-align: right">
      <a class="button" onclick="var id = <%= jukebox.jukebox_id %>; editJ(id);">Edit</a>
    </td>

    <td id="JtdEN<%= jukebox.jukebox_id %>" style="display: none">
      <input name="jukeboxname" value="<%= jukebox.jukeboxname %>">
    </td>
    <td id="JtdEC<%= jukebox.jukebox_id %>" style="display: none">
      <textarea name="jukeboxdesc" rows="4" cols="25"><%= jukebox.jukeboxdesc %></textarea>
    </td>
    <td id="JtdEB<%= jukebox.jukebox_id %>" style="display: none; text-align: right">
      <a class="button" onclick="var id = <%= jukebox.jukebox_id %>; closeeditJ(id);">Close</a>     
      <input type="submit" value="Save" /> 

    </form>

    <form method="POST" action="/deletejukebox" onsubmit="return confirm('Sure you want to delete this jukebox?')">
      <input type="hidden" name="jukebox_id" value="<%= jukebox.jukebox_id %>">
      <input type="submit" value="Delete" />
    </td>
    </form>
  </tr>
    <% });
  }; %>  
  <form method="POST" action="/addjukebox">
  <tr>
    <td>*</td>
    <td><input name="jukeboxname" type="text" placeholder="Name it something fancy"></td>
    <td><textarea name="jukeboxdesc" rows="4" cols="25" placeholder="255-character elevator pitch... go!"></textarea></td>
    <td style="text-align: right"><input type="submit" value="Add" /></td>
  </tr>
  </form>
</table>

<h3>My wax</h3>
<% if(copiesdata) { %>

  <table>
    <tr>
      <th>ID</th>
      <th>Release</th>
      <th>Year</th>
      <th>My notes</th>
      <th>Options</th>
    </tr>
    <% 
    copiesdata.forEach(copy => { 
      let clip = 30;
      let trunc;
      if (copy.ownercomment == null) {
        trunc = '';
      } else if (copy.ownercomment.length<clip) {
        trunc = copy.ownercomment;
      } else {
        trunc = copy.ownercomment.slice(0,clip-1) + '…';
      }
    %>

    <form method="POST" action="/editcopy" onsubmit="return confirm('Sure you want to save changes to this copy?')">
    <tr>
      <td><%= copy.copy_id %></td>
      <td><a href="/vinyl?id=<%= copy.release_id %>"><%= copy.releasename %></a></td>
      <td><%= copy.year %></td>
      <td id="CtdVC<%= copy.copy_id %>" style="display: table-cell"><%= trunc %></td>
      <td id="CtdVB<%= copy.copy_id %>" style="display: table-cell; text-align: right">
        <a class="button" onclick="var id = <%= copy.copy_id %>; editC(id);">Edit</a>
      </td>
      <td id="CtdEB<%= copy.copy_id %>" style="display: none; text-align: right" colspan="2">
        <a class="button" onclick="var id = <%= copy.copy_id %>; closeeditC(id);">Close</a>    
      </td>    
    </tr>
    <tr id="CtrEC<%= copy.copy_id %>" style="display: none">
      <td colspan="4">
        <textarea name="ownercomment" rows="4" cols="50"><%= copy.ownercomment %></textarea>
      </td>
      <td style="text-align: right">
        <input type="hidden" id="copy_id" name="copy_id" value="<%= copy.copy_id %>">
        <input type="submit" name="toupdate" value="Save" />
        </form>
        <form method="POST" action="/deletecopy" onsubmit="return confirm('Sure you want to remove this copy from the site?')">
        <input type="hidden" id="copy_id" name="copy_id" value="<%= copy.copy_id %>">
        <input type="submit" name="todelete" value="Delete" />
        </form>
      </td>
    </tr>
    <tr id="CtrEJ<%= copy.copy_id %>" style="display: none">
      <form method="POST" action="/popjukebox">
      <input type="hidden" name="copy_id" value="<%= copy.copy_id %>">
      <td colspan="4">
        <select name="jukebox_id">
          <option value="" selected>Add your copy to a jukebox…</option>
          <% if(jukeboxesdata) jukeboxesdata.forEach( jukebox => { %>
          <option value="<%= jukebox.jukebox_id %>"><%= jukebox.jukeboxname %></option>
          <% }); %>
        </select>
      </td>
      <td style="text-align: right">
        <input type="submit" value="Pop in" />
      </td>
      </form>
    </tr>
    
    <% }); %>
  </table>

<% }; %>

<a class="button" href="/collector?id=<%= user_id %>">My page</a>

<%- include('footer') %>

<script src="editbuttonSCRIPT.js"></script>